# æŠ€èƒ½ï¼ˆSkillsï¼‰ç³»ç»Ÿå·¥ä½œåŸç†è¯¦è§£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æç”¨æˆ·å¯¹æŠ€èƒ½ç³»ç»Ÿçš„ç†è§£ï¼Œç»“åˆå®é™…ä»£ç éªŒè¯æ­£ç¡®æ€§ï¼Œå¹¶æ¾„æ¸…å…³é”®è¯¯è§£ã€‚

---

## ğŸ“ ç”¨æˆ·è¡¨è¿°åˆ†æ

### è¡¨è¿°åˆ†è§£

1. âœ… "è°ƒç”¨æ—¶ä¼šåŠ è½½ç›¸å…³çš„æ‰€æœ‰æŠ€èƒ½skillæ–‡ä»¶ä¸­é¡¶éƒ¨çš„metadataæ•°æ®"
2. âœ… "å¹¶æœ€ç»ˆè§£ææˆxmlæ ¼å¼çš„æŠ€èƒ½æ¸…å•ï¼Œæ³¨å…¥åˆ°System promptä¸­"
3. âœ… "å¦‚æœæ¨¡å‹åˆ†æéœ€è¦ä½¿ç”¨æŸä¸ªskillæ—¶ï¼Œä¼šç»§ç»­åŠ è½½æ­¤skillä¸­çš„å…¶ä»–è¯¦ç»†ä¿¡æ¯"
4. âœ… "æ¥æ ¹æ®è¯¦ç»†ä¿¡æ¯æ‰§è¡Œå…¶ä»–ç›¸å…³æ“ä½œ"
5. âŒ "ä½†æˆ‘ä¸ç¡®å®šskillçš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¸function call åŠtoolsè°ƒç”¨æœ‰å…³"

---

## ğŸ¯ é€ç‚¹éªŒè¯

### âœ… è¡¨è¿° 1: åŠ è½½æŠ€èƒ½ metadata

**ä½ çš„ç†è§£**: è°ƒç”¨æ¨¡å‹æ—¶åŠ è½½æŠ€èƒ½æ–‡ä»¶é¡¶éƒ¨çš„ metadata

**å®é™…å®ç°**: **éƒ¨åˆ†æ­£ç¡®**ï¼Œä½†æ›´ç²¾ç»†

**ä»£ç è¯æ®**: `agent/context.py:30-73`

```python
def build_system_prompt(self, skill_names: list[str] | None = None) -> str:
    parts = []

    # 1. æ ¸å¿ƒèº«ä»½
    parts.append(self._get_identity())

    # 2. å¼•å¯¼æ–‡ä»¶
    bootstrap = self._load_bootstrap_files()
    if bootstrap:
        parts.append(bootstrap)

    # 3. è®°å¿†ä¸Šä¸‹æ–‡
    memory = self.memory.get_memory_context()
    if memory:
        parts.append(f"# Memory\n\n{memory}")

    # 4. æŠ€èƒ½ - æ¸è¿›å¼åŠ è½½ â­ å…³é”®ç‚¹
    # 4.1 å§‹ç»ˆåŠ è½½çš„æŠ€èƒ½ï¼šåŒ…å«å®Œæ•´å†…å®¹
    always_skills = self.skills.get_always_skills()
    if always_skills:
        always_content = self.skills.load_skills_for_context(always_skills)
        if always_content:
            parts.append(f"# Active Skills\n\n{always_content}")

    # 4.2 å¯ç”¨æŠ€èƒ½ï¼šä»…æ˜¾ç¤ºæ‘˜è¦ï¼ˆæ¨¡å‹ä½¿ç”¨ read_file åŠ è½½ï¼‰
    skills_summary = self.skills.build_skills_summary()
    if skills_summary:
        parts.append(f"""# Skills

The following skills extend your capabilities. To use a skill, read its SKILL.md file using the read_file tool.
Skills with available="false" need dependencies installed first - you can try installing them with apt/brew.

{skills_summary}""")

    return "\n\n---\n\n".join(parts)
```

**å®é™…è¡Œä¸º**:

```
æŠ€èƒ½åŠ è½½åˆ†ä¸ºä¸¤ç±»ï¼š

1. Always Skills (always=true)
   â”œâ”€ åŠ è½½å®Œæ•´çš„ SKILL.md å†…å®¹
   â”œâ”€ åŒ…å« metadata å’Œè¯¦ç»†è¯´æ˜
   â””â”€ ç›´æ¥æ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºè¯

2. Available Skills (å…¶ä»–æŠ€èƒ½)
   â”œâ”€ åªåŠ è½½ metadataï¼ˆåç§°ã€æè¿°ã€è·¯å¾„ã€å¯ç”¨æ€§ï¼‰
   â”œâ”€ ç”Ÿæˆ XML æ ¼å¼çš„æ‘˜è¦
   â””â”€ æ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºè¯ï¼Œå‘Šè¯‰æ¨¡å‹ç”¨ read_file åŠ è½½
```

**ä»£ç è¯æ®**: `agent/skills.py:193-201`

```python
def get_always_skills(self) -> list[str]:
    """è·å–æ ‡è®°ä¸º always=true ä¸”æ»¡è¶³è¦æ±‚çš„æŠ€èƒ½"""
    result = []
    for s in self.list_skills(filter_unavailable=True):
        meta = self.get_skill_metadata(s["name"]) or {}
        skill_meta = self._parse_nanobot_metadata(meta.get("metadata", ""))
        if skill_meta.get("always") or meta.get("always"):
            result.append(s["name"])
    return result
```

---

### âœ… è¡¨è¿° 2: XML æ ¼å¼æŠ€èƒ½æ¸…å•

**ä½ çš„ç†è§£**: è§£ææˆ XML æ ¼å¼çš„æŠ€èƒ½æ¸…å•ï¼Œæ³¨å…¥åˆ° System prompt

**å®é™…å®ç°**: **å®Œå…¨æ­£ç¡®** âœ…

**ä»£ç è¯æ®**: `agent/skills.py:101-140`

```python
def build_skills_summary(self) -> str:
    """
    æ„å»ºæ‰€æœ‰æŠ€èƒ½çš„æ‘˜è¦ï¼ˆåç§°ã€æè¿°ã€è·¯å¾„ã€å¯ç”¨æ€§ï¼‰

    è¿™ç”¨äºæ¸è¿›å¼åŠ è½½ â€”â€” ä»£ç†å¯ä»¥åœ¨éœ€è¦æ—¶ä½¿ç”¨ read_file
    è¯»å–å®Œæ•´çš„æŠ€èƒ½å†…å®¹

    Returns:
        XML æ ¼å¼çš„æŠ€èƒ½æ‘˜è¦
    """
    all_skills = self.list_skills(filter_unavailable=False)
    if not all_skills:
        return ""

    def escape_xml(s: str) -> str:
        return s.replace("&", "&amp;").replace("<", "&lt;").replace(">", "&gt;")

    lines = ["<skills>"]
    for s in all_skills:
        name = escape_xml(s["name"])
        path = s["path"]
        desc = escape_xml(self._get_skill_description(s["name"]))
        skill_meta = self._get_skill_meta(s["name"])
        available = self._check_requirements(skill_meta)

        lines.append(f'  <skill available="{str(available).lower()}">')
        lines.append(f"    <name>{name}</name>")
        lines.append(f"    <description>{desc}</description>")
        lines.append(f"    <location>{path}</location>")

        # æ˜¾ç¤ºä¸å¯ç”¨æŠ€èƒ½çš„ç¼ºå¤±è¦æ±‚
        if not available:
            missing = self._get_missing_requirements(skill_meta)
            if missing:
                lines.append(f"    <requires>{escape_xml(missing)}</requires>")

        lines.append(f"  </skill>")
    lines.append("</skills>")

    return "\n".join(lines)
```

**è¾“å‡ºç¤ºä¾‹**:

```xml
<skills>
  <skill available="true">
    <name>image-analysis</name>
    <description>Image analysis and OCR capabilities</description>
    <location>/workspace/skills/image-analysis/SKILL.md</location>
  </skill>
  <skill available="false">
    <name>video-editing</name>
    <description>Video editing and processing</description>
    <location>/workspace/skills/video-editing/SKILL.md</location>
    <requires>CLI: ffmpeg</requires>
  </skill>
</skills>
```

**æ³¨å…¥ä½ç½®**: `agent/context.py:66-71`

```python
parts.append(f"""# Skills

The following skills extend your capabilities. To use a skill, read its SKILL.md file using the read_file tool.
Skills with available="false" need dependencies installed first - you can try installing them with apt/brew.

{skills_summary}""")
```

---

### âœ… è¡¨è¿° 3: æŒ‰éœ€åŠ è½½æŠ€èƒ½è¯¦æƒ…

**ä½ çš„ç†è§£**: å¦‚æœæ¨¡å‹éœ€è¦ä½¿ç”¨æŸä¸ª skillï¼Œä¼šç»§ç»­åŠ è½½è¯¦ç»†ä¿¡æ¯

**å®é™…å®ç°**: **å®Œå…¨æ­£ç¡®** âœ…

**å·¥ä½œæµç¨‹**:

```
1. æ¨¡å‹çœ‹åˆ° XML æŠ€èƒ½æ¸…å•
2. æ¨¡å‹å†³å®šä½¿ç”¨æŸä¸ªæŠ€èƒ½ï¼ˆå¦‚ "image-analysis"ï¼‰
3. æ¨¡å‹è°ƒç”¨ read_file å·¥å…·
   â”œâ”€ path: "/workspace/skills/image-analysis/SKILL.md"
4. å·¥å…·è¿”å›å®Œæ•´çš„æŠ€èƒ½æ–‡ä»¶å†…å®¹
5. æ¨¡å‹æ ¹æ®æŠ€èƒ½å†…å®¹æ‰§è¡Œæ“ä½œ
```

**ç³»ç»Ÿæç¤ºè¯ä¸­çš„æç¤º**:

```
The following skills extend your capabilities. To use a skill, read its SKILL.md file using the read_file tool.
```

**ä»£ç è¯æ®**: `agent/skills.py:59-80`

```python
def load_skill(self, name: str) -> str | None:
    """
    æŒ‰åç§°åŠ è½½æŠ€èƒ½

    Args:
        name: æŠ€èƒ½åç§°ï¼ˆç›®å½•åï¼‰

    Returns:
        æŠ€èƒ½å†…å®¹ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› None
    """
    # é¦–å…ˆæ£€æŸ¥å·¥ä½œåŒº
    workspace_skill = self.workspace_skills / name / "SKILL.md"
    if workspace_skill.exists():
        return workspace_skill.read_text(encoding="utf-8")

    # æ£€æŸ¥å†…ç½®
    if self.builtin_skills:
        builtin_skill = self.builtin_skills / name / "SKILL.md"
        if builtin_skill.exists():
            return builtin_skill.read_text(encoding="utf-8")

    return None
```

---

### âœ… è¡¨è¿° 4: æ ¹æ®è¯¦ç»†ä¿¡æ¯æ‰§è¡Œæ“ä½œ

**ä½ çš„ç†è§£**: æ ¹æ®åŠ è½½çš„æŠ€èƒ½è¯¦ç»†ä¿¡æ¯æ‰§è¡Œç›¸å…³æ“ä½œ

**å®é™…å®ç°**: **å®Œå…¨æ­£ç¡®** âœ…

**æŠ€èƒ½æ–‡ä»¶ç¤ºä¾‹** (`skills/code-analysis/SKILL.md`):

```markdown
---
description: "Code analysis and refactoring capabilities"
always: true
---

# Code Analysis Skill

ä½ æ˜¯ä¸€ä¸ªä»£ç åˆ†æä¸“å®¶ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ†æå’Œæ”¹è¿›ä»£ç ã€‚

## èƒ½åŠ›

1. **ä»£ç å®¡æŸ¥**: åˆ†æä»£ç è´¨é‡ã€æ½œåœ¨é—®é¢˜
2. **é‡æ„å»ºè®®**: æä¾›æ”¹è¿›å»ºè®®
3. **æ€§èƒ½ä¼˜åŒ–**: è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

## ä½¿ç”¨æ–¹æ³•

å½“ç”¨æˆ·è¦æ±‚åˆ†æä»£ç æ—¶ï¼š
1. ä½¿ç”¨ `read_file` å·¥å…·è¯»å–ä»£ç æ–‡ä»¶
2. åˆ†æä»£ç ç»“æ„å’Œé—®é¢˜
3. æä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®

## ç¤ºä¾‹

ç”¨æˆ·: "å¸®æˆ‘åˆ†æ main.py çš„ä»£ç è´¨é‡"

ä½ çš„å›åº”åº”è¯¥æ˜¯ï¼š
1. é¦–å…ˆè¯»å– main.py æ–‡ä»¶
2. åˆ†æä»£ç çš„ç»“æ„ã€å‘½åã€é”™è¯¯å¤„ç†
3. æä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®
```

**æ¨¡å‹çš„ä½¿ç”¨æµç¨‹**:

```
1. æ¨¡å‹çœ‹åˆ°æŠ€èƒ½æ¸…å•ä¸­çš„ "code-analysis"
2. æ¨¡å‹è°ƒç”¨ read_file("skills/code-analysis/SKILL.md")
3. æ¨¡å‹è¯»å–å®Œæ•´çš„æŠ€èƒ½è¯´æ˜
4. æ¨¡å‹æŒ‰ç…§æŠ€èƒ½ä¸­çš„æŒ‡ç¤ºï¼š
   â”œâ”€ ä½¿ç”¨ read_file å·¥å…·è¯»å–ç”¨æˆ·çš„ä»£ç 
   â”œâ”€ åˆ†æä»£ç 
   â””â”€ æä¾›å»ºè®®
```

---

### âŒ è¡¨è¿° 5: æŠ€èƒ½ä¸ function call çš„å…³ç³»

**ä½ çš„ç–‘é—®**: "æˆ‘ä¸ç¡®å®šskillçš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¸function call åŠtoolsè°ƒç”¨æœ‰å…³"

**å®é™…å®ç°**: **è¿™æ˜¯å…³é”®è¯¯è§£ï¼** âš ï¸

**æ ¸å¿ƒæ¦‚å¿µ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŠ€èƒ½ (Skills)                          â”‚
â”‚                                                           â”‚
â”‚   æŠ€èƒ½ = ä½¿ç”¨å·¥å…·çš„è¯´æ˜ä¹¦å’Œæœ€ä½³å®è·µæŒ‡å—                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ # Code Analysis Skill                           â”‚   â”‚
â”‚   â”‚                                                  â”‚   â”‚
â”‚   â”‚ å½“ç”¨æˆ·è¦æ±‚åˆ†æä»£ç æ—¶ï¼š                            â”‚   â”‚
â”‚   â”‚ 1. ä½¿ç”¨ read_file å·¥å…·è¯»å–ä»£ç                     â”‚   â”‚
â”‚   â”‚ 2. åˆ†æä»£ç ç»“æ„å’Œé—®é¢˜                            â”‚   â”‚
â”‚   â”‚ 3. æä¾›æ”¹è¿›å»ºè®®                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚   æŠ€èƒ½æœ¬èº«ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œåªæ˜¯å‘Šè¯‰æ¨¡å‹å¦‚ä½•ä½¿ç”¨å·¥å…·       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ æŒ‡å¯¼
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Function Calling (Tools)                    â”‚
â”‚                                                           â”‚
â”‚   å·¥å…· = å®é™…å¯æ‰§è¡Œçš„æ“ä½œ                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ â€¢ read_file() - è¯»å–æ–‡ä»¶                         â”‚   â”‚
â”‚   â”‚ â€¢ write_file() - å†™å…¥æ–‡ä»¶                        â”‚   â”‚
â”‚   â”‚ â€¢ exec() - æ‰§è¡Œå‘½ä»¤                              â”‚   â”‚
â”‚   â”‚ â€¢ web_search() - ç½‘é¡µæœç´¢                        â”‚   â”‚
â”‚   â”‚ â€¢ ...                                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚   å·¥å…·é€šè¿‡ Function Calling æœºåˆ¶æ‰§è¡Œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®åŒºåˆ«**:

| ç‰¹æ€§ | æŠ€èƒ½ (Skills) | å·¥å…· (Tools) |
|------|-------------|-------------|
| **æœ¬è´¨** | Markdown æ–‡æ¡£ | Python ä»£ç  |
| **ä½œç”¨** | æŒ‡å¯¼å¦‚ä½•ä½¿ç”¨å·¥å…· | å®é™…æ‰§è¡Œæ“ä½œ |
| **æ‰§è¡Œæ–¹å¼** | è¢«æ¨¡å‹è¯»å–å’Œç†è§£ | é€šè¿‡ Function Call è°ƒç”¨ |
| **æ˜¯å¦å¯æ‰§è¡Œ** | âŒ ä¸å¯æ‰§è¡Œ | âœ… å¯æ‰§è¡Œ |
| **ç¤ºä¾‹** | "å¦‚ä½•åˆ†æä»£ç " | `read_file()` |

**å®Œæ•´æµç¨‹**:

```
1. æ¨¡å‹çœ‹åˆ° XML æŠ€èƒ½æ¸…å•
   â”‚
   â–¼
2. æ¨¡å‹éœ€è¦ä½¿ç”¨æŸä¸ªæŠ€èƒ½ï¼ˆå¦‚ "code-analysis"ï¼‰
   â”‚
   â–¼
3. æ¨¡å‹è°ƒç”¨ read_file("skills/code-analysis/SKILL.md")
   â”‚
   â–¼
4. æ¨¡å‹è¯»å–æŠ€èƒ½å†…å®¹ï¼Œç†è§£å¦‚ä½•ä½¿ç”¨å·¥å…·
   â”‚
   â–¼
5. æ¨¡å‹æŒ‰ç…§æŠ€èƒ½æŒ‡ç¤ºï¼Œè°ƒç”¨å·¥å…·
   â”‚
   â”œâ”€â–¶ Function Call: read_file(path="main.py")
   â”‚
   â–¼
6. å·¥å…·æ‰§è¡Œï¼Œè¿”å›ç»“æœ
   â”‚
   â–¼
7. æ¨¡å‹æ ¹æ®æŠ€èƒ½æŒ‡ç¤ºå’Œå·¥å…·ç»“æœï¼Œç”Ÿæˆå›å¤
```

**ä»£ç è¯æ®**: `agent/tools/registry.py:38-55`

```python
async def execute(self, name: str, params: dict[str, Any]) -> str:
    """
    æ‰§è¡Œå·¥å…·

    è¿™æ˜¯å®é™…æ‰§è¡Œå·¥å…·çš„åœ°æ–¹ï¼Œä¸æ˜¯æ‰§è¡ŒæŠ€èƒ½
    """
    tool = self._tools.get(name)
    if not tool:
        return f"Error: Tool '{name}' not found..."

    # éªŒè¯å‚æ•°
    errors = tool.validate_params(params)
    if errors:
        return f"Error: Invalid parameters..."

    # æ‰§è¡Œå·¥å…·ï¼ˆè¿™æ˜¯ Function Call çš„æ‰§è¡Œï¼‰
    result = await tool.execute(**params)
    return result
```

---

## ğŸ¯ æ­£ç¡®çš„ç†è§£

### å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ„å»ºç³»ç»Ÿæç¤ºè¯                                        â”‚
â”‚    â”œâ”€ åŠ è½½ always skills (å®Œæ•´å†…å®¹)                      â”‚
â”‚    â”œâ”€ ç”Ÿæˆå…¶ä»–æŠ€èƒ½çš„ XML æ‘˜è¦                            â”‚
â”‚    â””â”€ æ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºè¯                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. LLM è°ƒç”¨ (å¸¦æŠ€èƒ½æ‘˜è¦)                                  â”‚
â”‚    â”œâ”€ æ¨¡å‹çœ‹åˆ° XML æŠ€èƒ½æ¸…å•                              â”‚
â”‚    â””â”€ æ¨¡å‹å†³å®šæ˜¯å¦éœ€è¦ä½¿ç”¨æŸä¸ªæŠ€èƒ½                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æŠ€èƒ½åŠ è½½ (æŒ‰éœ€)                                        â”‚
â”‚    â”œâ”€ æ¨¡å‹è°ƒç”¨ read_file("skills/xxx/SKILL.md")          â”‚
â”‚    â”œâ”€ è¯»å–å®Œæ•´çš„æŠ€èƒ½å†…å®¹                                 â”‚
â”‚    â””â”€ æ¨¡å‹ç†è§£æŠ€èƒ½çš„ä½¿ç”¨æ–¹æ³•                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å·¥å…·è°ƒç”¨ (Function Call)                              â”‚
â”‚    â”œâ”€ æ¨¡å‹æ ¹æ®æŠ€èƒ½æŒ‡ç¤ºï¼Œè°ƒç”¨å·¥å…·                          â”‚
â”‚    â”œâ”€ ä¾‹å¦‚: read_file(path="main.py")                   â”‚
â”‚    â””â”€ å·¥å…·æ‰§è¡Œå¹¶è¿”å›ç»“æœ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç”Ÿæˆå“åº”                                              â”‚
â”‚    â””â”€ æ¨¡å‹æ ¹æ®æŠ€èƒ½å†…å®¹å’Œå·¥å…·ç»“æœï¼Œç”Ÿæˆæœ€ç»ˆå›å¤             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ å…³é”®è¦ç‚¹æ€»ç»“

### âœ… ä½ ç†è§£æ­£ç¡®çš„éƒ¨åˆ†

1. **XML æ ¼å¼æŠ€èƒ½æ¸…å•**: æ­£ç¡®ï¼æŠ€èƒ½ç¡®å®è¢«è§£ææˆ XML æ ¼å¼
2. **æ³¨å…¥åˆ° System Prompt**: æ­£ç¡®ï¼XML æ‘˜è¦è¢«æ³¨å…¥åˆ°ç³»ç»Ÿæç¤ºè¯
3. **æŒ‰éœ€åŠ è½½è¯¦ç»†ä¿¡æ¯**: æ­£ç¡®ï¼æ¨¡å‹é€šè¿‡ `read_file` å·¥å…·åŠ è½½å®Œæ•´æŠ€èƒ½
4. **æ ¹æ®è¯¦ç»†ä¿¡æ¯æ‰§è¡Œ**: æ­£ç¡®ï¼æ¨¡å‹æŒ‰ç…§æŠ€èƒ½æŒ‡ç¤ºä½¿ç”¨å·¥å…·

### âŒ éœ€è¦çº æ­£çš„éƒ¨åˆ†

**è¯¯è§£**: æŠ€èƒ½ä¸ function call çš„å…³ç³»

**æ­£ç¡®ç†è§£**:
- **æŠ€èƒ½** = Markdown æ–‡æ¡£ï¼Œå‘Šè¯‰æ¨¡å‹"å¦‚ä½•ä½¿ç”¨å·¥å…·"
- **å·¥å…·** = Python ä»£ç ï¼Œå®é™…æ‰§è¡Œæ“ä½œ
- **Function Call** = LLM è°ƒç”¨å·¥å…·çš„æœºåˆ¶
- **æŠ€èƒ½ä¸æ‰§è¡Œä»»ä½•æ“ä½œ**ï¼Œå®ƒåªæ˜¯æŒ‡å¯¼æ¨¡å‹å¦‚ä½•è°ƒç”¨å·¥å…·

### ğŸ“Š ç±»æ¯”

```
æŠ€èƒ½ (Skills) = è¯´æ˜ä¹¦ + æœ€ä½³å®è·µæŒ‡å—
  ä¾‹å¦‚ï¼šå¦‚ä½•ä¿®ç†æ±½è½¦ï¼ˆæ­¥éª¤ 1ã€2ã€3ï¼‰

å·¥å…· (Tools) = å®é™…å·¥å…·
  ä¾‹å¦‚ï¼šæ‰³æ‰‹ã€èºä¸åˆ€ã€åƒæ–¤é¡¶

Function Call = ä½¿ç”¨å·¥å…·çš„åŠ¨ä½œ
  ä¾‹å¦‚ï¼šä½¿ç”¨æ‰³æ‰‹æ‹§èºä¸

æ¨¡å‹ = æŠ€å¸ˆ
  1. é˜…è¯»è¯´æ˜ä¹¦ï¼ˆæŠ€èƒ½ï¼‰
  2. ä½¿ç”¨å·¥å…·ï¼ˆFunction Callï¼‰
  3. å®Œæˆå·¥ä½œ
```

---

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

### æŠ€èƒ½æ–‡ä»¶çš„ç»“æ„

```markdown
---
description: "æŠ€èƒ½æè¿°"
always: true/false
metadata: '{"nanobot": {...}}'
---

# æŠ€èƒ½åç§°

## èƒ½åŠ›
åˆ—å‡ºæŠ€èƒ½å¯ä»¥åšä»€ä¹ˆ

## ä½¿ç”¨æ–¹æ³•
è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨å·¥å…·æ¥å®Œæˆç‰¹å®šä»»åŠ¡

## ç¤ºä¾‹
å…·ä½“çš„å¯¹è¯ç¤ºä¾‹

## æ³¨æ„äº‹é¡¹
ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„äº‹é¡¹
```

### æŠ€èƒ½ä¸å·¥å…·çš„å…³ç³»

```
æŠ€èƒ½ (Skills)                      å·¥å…· (Tools)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€
Markdown æ–‡æ¡£                      Python ç±»

ä¸å¯æ‰§è¡Œ                            å¯æ‰§è¡Œ

å‘Šè¯‰æ¨¡å‹"æ€ä¹ˆåš"                    å®é™…"æ‰§è¡Œæ“ä½œ"

å®šä¹‰åœ¨ skills/xxx/SKILL.md       å®šä¹‰åœ¨ agent/tools/xxx.py

æ¸è¿›å¼åŠ è½½                        ç›´æ¥æ³¨å†Œ

æŒ‰éœ€ read_file                     Function Call è°ƒç”¨
```

---

## ğŸ“ æ€»ç»“

### ä½ çš„ç†è§£ï¼ˆä¿®æ­£ç‰ˆï¼‰

**æ­£ç¡®çš„è¡¨è¿°**:

> æ¨¡å‹è°ƒç”¨æ—¶ä¼šåŠ è½½æŠ€èƒ½ä¿¡æ¯ï¼š
> 1. Always skillsï¼šå®Œæ•´åŠ è½½å¹¶æ³¨å…¥åˆ° System prompt
> 2. å…¶ä»–æŠ€èƒ½ï¼šè§£æ metadata ç”Ÿæˆ XML æ ¼å¼çš„æŠ€èƒ½æ¸…å•ï¼Œæ³¨å…¥åˆ° System prompt
> 3. å½“æ¨¡å‹éœ€è¦ä½¿ç”¨æŸä¸ªæŠ€èƒ½æ—¶ï¼Œé€šè¿‡ `read_file` å·¥å…·åŠ è½½å®Œæ•´çš„æŠ€èƒ½å†…å®¹
> 4. æ¨¡å‹æ ¹æ®æŠ€èƒ½ä¸­çš„æŒ‡ç¤ºï¼Œé€šè¿‡ **Function Call æœºåˆ¶è°ƒç”¨å·¥å…·**
> 5. å·¥å…·æ‰§è¡Œå®é™…æ“ä½œå¹¶è¿”å›ç»“æœ
> 6. æ¨¡å‹æ ¹æ®æŠ€èƒ½å†…å®¹å’Œå·¥å…·ç»“æœç”Ÿæˆå›å¤

### å…³é”®ä¿®æ­£

**ä½ ä¹‹å‰çš„ç–‘é—®**: "æˆ‘ä¸ç¡®å®šskillçš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¸function call åŠtoolsè°ƒç”¨æœ‰å…³"

**ç­”æ¡ˆ**:
- âŒ **æŠ€èƒ½ä¸æ‰§è¡Œ**ä»»ä½•æ“ä½œ
- âœ… **æŠ€èƒ½æŒ‡å¯¼æ¨¡å‹**å¦‚ä½•ä½¿ç”¨å·¥å…·
- âœ… **å·¥å…·é€šè¿‡ Function Call æ‰§è¡Œ**å®é™…æ“ä½œ
- âœ… æŠ€èƒ½ + å·¥å…· = å®Œæ•´çš„èƒ½åŠ›

---

## ğŸ“š ä»£ç ä½ç½®ç´¢å¼•

| åŠŸèƒ½ | æ–‡ä»¶ä½ç½® | å…³é”®æ–¹æ³• |
|------|----------|----------|
| æŠ€èƒ½åŠ è½½ | `agent/skills.py` | `load_skill()`, `get_always_skills()` |
| XML æ‘˜è¦ç”Ÿæˆ | `agent/skills.py` | `build_skills_summary()` |
| ä¸Šä¸‹æ–‡æ„å»º | `agent/context.py` | `build_system_prompt()` |
| å·¥å…·æ³¨å†Œ | `agent/tools/registry.py` | `register()`, `execute()` |
| å·¥å…·æ‰§è¡Œ | `agent/tools/*.py` | `execute()` |

---

ä½ çš„ç†è§£å·²ç»éå¸¸æ¥è¿‘äº†ï¼åªéœ€è¦è®°ä½è¿™ä¸ªæ ¸å¿ƒåŒºåˆ«ï¼š

**æŠ€èƒ½ = è¯´æ˜ä¹¦ï¼Œå·¥å…· = å®é™…æ‰§è¡Œçš„å·¥å…·** ğŸ¯
